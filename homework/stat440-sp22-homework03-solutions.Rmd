
title: "STAT 440 Statistical Data Management - Spring 2022"
output: html_document
---

## Homework03
### Due: Monday March 07, 2022 11:59 pm US Central Time
#### Created by Christopher Kinson

Grading Rubric (per question):  
2 points if complete and correct  
1 point if incomplete or incorrect  
0 points if no attempt made  


**Retrieving your work**

This and all future homework .Rmd files are written in Markdown. The .Rmd file can be rendered as an .html file for easier viewing. This and all future homework assignments are located in the **homework** directory within the **stat440-sp22-course-content** repo, i.e. **stat440-sp22-course-content/homework** in GitHub. It is always recommended that you **pull** (or refresh) the **stat440-sp22-course-content** repo to ensure that you have the most updated version of all course content including the homework assignments. After pulling (or refreshing) the **stat440-sp22-course-content** repo, the homework file will be in the homework directory. Once you have opened the .Rmd file, you may begin writing your answers beneath each problem. Do not remove any of the original problems from the file, because that makes it more difficult for the course staff to grade your assignment. 

**Submitting your work**

In your individual student repo (named as your netID), you are to submit ***two*** files:

a. Your reproducible document file (.Rmd) which should be saved as homework#-netID.Rmd. For example, my homework 01 file would be saved as homework01-kinson2.Rmd.

b. Your rendered reproducible document file (.html) which should be saved as homework#-netID.html. For example, my homework 01 file would be saved as homework01-kinson2.html.

**Do not place your files in a sub-directory (or folder).** You have an unlimited number of submissions, but only the latest proper submission (commit and push) will be viewed and graded. **Remember the .Rmd file needs to render properly to .html before submitting.** 


***

Undergraduates are expected to complete the problems **#1-#8**. Graduate students are expected to complete all problems.

**The following problems should be completed by you as an individual. If any problem asks you a particular question, be sure to answer it completely (with code, written sentences, or both). Written sentences should not appear in code chunks or code cells. Written sentences should appear in Markdown syntax unless specifically stated otherwise.**

***Do not change anything in this file above the double line. Doing so will prevent your homework from being graded.***

***
***

### Use the URLs to access the data. No local files allowed.


**#1** (Markdown) Using Markdown syntax, make a non-numbered list with your first name in bold text as the first item and your last name in normal text as the second item.

**Answer:** Answers will vary, but must be a proper list with first name in bold text and last name as second item in normal text.

**#2** (Personal survey, Markdown) Think about the previous two weeks (your experiences, assignments, and life). Using Markdown, describe in paragraph form (with at least 3 complete sentences): what was the most challenging part(s) about those weeks, and the thing(s) that made your weeks successful or unsuccessful.

**Answer:** Answers will vary, graded for completeness.

**#3** (Loops and conditional execution, Markdown)

statement: The `for` loop can be used to handle grouped data summarization.

If the text in bold is the term that makes the statement true, then write TRUE below in all caps. If the text in bold is the term that makes the statement false, then write FALSE below in all caps and write the correct term in bold text in a new line under FALSE.

**Answer:** TRUE

**#4** (Loops and conditional execution, Markdown)

statement: The condition-controlled loop is one in which repetitive actions are repeated for a predetermined number of times and stopped when the that number of times is reached.


**Answer:** FALSE

**#5** (Accessing and importing data, Arranging data, Data reduction, Data expansion, Vectorization, Regular expressions and string manipulation, Summarizing data, Markdown) Import the Chicago Towed Vehicles Data using its URL https://uofi.box.com/shared/static/2yfvl36q1th1aq2nvhtiomhsk2uxip6u.csv and apply data management concepts to answer the following question in Markdown syntax and complete sentence(s): 

- Among vehicle Makes with a frequency larger than 25, which vehicle Makes were tied in frequency in Chicago? Keep in mind that the following Makes are incorrectly recorded in the data. Thus, they need to be corrected prior to answering the question.

  - HON should be HOND
  - JAG should be JAGU
  - LAND should be LNDR
  - SATU should be STRN
  - SATR should be STRN
  - TOYO should be TOYT

Chicago Towed Vehicles Data description: This dataset contains 3470 rows and 10 variables. The subjects are locations for vehicles that have been towed and impounded by the City of Chicago. Illegally parked vehicles, abandoned vehicles and vehicles used for illegal activities may be towed. Original source is City of Chicago.

**Answer:** HOND and TOYT were tied at a towed frequency of 271. BUIC and CHRY were tied at a towed frequency of 93. AUDI, MITS, and SUBA were tied at a towed frequency of 41. LINC and MERZ were tied at a towed frequency of 30.

```{r prob5}
library(tidyverse)
tow <- read_csv("https://uofi.box.com/shared/static/2yfvl36q1th1aq2nvhtiomhsk2uxip6u.csv", 
    col_types = cols(`Tow Date` = col_date(format = "%m/%d/%Y")))

tow$Make <- str_replace(tow$Make,"^HON$", "HOND")
tow$Make <- str_replace(tow$Make,"^JAG$", "JAGU")
tow$Make <- str_replace(tow$Make,"LAND", "LNDR")
tow$Make <- str_replace(tow$Make,"SATU", "STRN")
tow$Make <- str_replace(tow$Make,"SATR", "STRN")
tow$Make <- str_replace(tow$Make,"TOYO", "TOYT")

tow %>%
  count(Make) %>%
  arrange(desc(n)) %>%
  filter(n>25) %>%
  group_by(n) %>%
  mutate(n2=n()) %>%
  filter(n2>1)
```

**#6** (Accessing and importing data, Arranging data, Data reduction, Data expansion, Vectorization, Regular expressions and string manipulation, Summarizing data, Markdown) Import the Chicago Public Chauffeurs Data using its URL https://uofi.box.com/shared/static/4qcdq6qtofbtn3m7ifrnxaahzv6x1x0r.csv and apply data management concepts to answer the following questions in Markdown syntax and complete sentence(s):

- Among the active public chauffeurs, which driver type has served the longest number of months on average? Exactly how many months on average?

Chicago Public Chauffeurs Data description: The dataset contains 22752 rows and 12 columns. The subjects are public chauffeurs in business in Chicago with licenses and various vehicle types. Original source is City of Chicago.

**Answer:** The taxicab is the longest-serving active driver type on average at ~~122.99~~ 210 months on average. If you were originally deducted a point for this problem, I have given you a point back.

```{r prob6}
driver <- read_csv("https://uofi.box.com/shared/static/4qcdq6qtofbtn3m7ifrnxaahzv6x1x0r.csv", 
    col_types = cols(Renewed = col_date(format = "%m/%Y"), 
        `Status Date` = col_date(format = "%m/%d/%Y"), 
        Expires = col_date(format = "%m/%Y"), 
        `Original Issue Date` = col_date(format = "%m/%d/%Y")))

driver %>%
  filter(Status=="ACTIVE") %>%
  group_by(`Driver Type`) %>%
  summarise(months=mean(as.vector(Expires-`Original Issue Date`)/(365/12), na.rm=TRUE)) %>%
  arrange(desc(months))
```

**#7** (Accessing and importing data, Arranging data, Data reduction, Data expansion, Vectorization, Regular expressions and string manipulation, Summarizing data, Markdown) Import the Chicago Public High Schools Progress Report Cards Data using its URL https://uofi.box.com/shared/static/2pd4ibwgbz0m5sojmc02svcihjrsgw5h.csv and address the following (in this order):

- mutates a new column called `College Enrollment Potential` which equals an estimate of the number of students who could have enrolled into college. This estimate is based on the `College Enrollment (number of students)` and `College Enrollment Rate %` columns.

- mutates a new column called "Latitude" which equals the latitude GPS value based on the Location column.

- mutates a new column called "Longitude" which equals the longitude GPS value based on the Location column.

- renames the following columns `Average Student Attendance` and `Average Teacher Attendance` as `Average Student Attendance %` and `Average Teacher Attendance %`.

- arranges by `Average Student Attendance %` (in descending order), `Average Teacher Attendance %` (in descending order), `Graduation Rate %` (in descending order), `College Enrollment Rate %` (in descending order), `Freshman on Track Rate %` (in descending order), and `Rate of Misconducts (per 100 students)` (in ascending order).

- selects the following columns: `Name of School`, `College Enrollment (number of students)`, `College Enrollment Rate %`, `College Enrollment Potential`, Location, Latitude, Longitude, `Average Student Attendance %`, and `Rate of Misconducts (per 100 students)`

- slices to keep the first 5 and last 5 rows

Chicago Public High Schools Progress Report Cards Data description: The dataset contains 93 rows and 42 columns. The subjects are high schools in the Chicago Public School system and their performance in various metrics of education. Some columns in this dataset include School ID and name, the type of school, Average student attendance, Rate of misconducts, 11th grade average ACT, Graduation rate, Freshmen on track %, Ward, and Location. Original source is City of Chicago.

**Answer:**

```{r prob7}
chs <- read_csv("https://uofi.box.com/shared/static/2pd4ibwgbz0m5sojmc02svcihjrsgw5h.csv")

chs %>%
  mutate(`College Enrollment Potential`=`College Enrollment (number of students)` /( as.numeric(`College Enrollment Rate %`)*0.01), Latitude=str_remove_all( str_extract(chs$Location, "\\(\\d+\\.\\d+\\,"), "\\(|\\," ), Longitude= str_remove_all( str_extract(chs$Location, "\\-\\d+\\.\\d+\\)"), "\\)")) %>%
   rename(`Average Student Attendance %`=`Average Student Attendance`,`Average Teacher Attendance %`=`Average Teacher Attendance`) %>%
   arrange( desc(`Average Student Attendance %`), desc(`Average Teacher Attendance %`), desc(`Graduation Rate %`), desc(`College Enrollment Rate %`), desc(`Freshman on Track Rate %`), `Rate of Misconducts (per 100 students)`) %>%
  select(`Name of School`, `College Enrollment (number of students)`, `College Enrollment Rate %`, `College Enrollment Potential`, Location, Latitude, Longitude, `Average Student Attendance %`, `Rate of Misconducts (per 100 students)`) %>%
  slice(c(1:5,(nrow(.)-4):nrow(.)))
```

**#8** (Accessing and importing data, Arranging data, Data reduction, Data expansion, Vectorization, Regular expressions and string manipulation, Summarizing data, Combining data, Markdown) Import the Chicago Crimes Data using its URL https://uofi.box.com/shared/static/xiipn7u18rcddau1q0elih3y7jcusket.csv and combine the with Chicago Crimes Data with the Chicago Public High Schools Progress Report Cards Data (**imported in Problem 7**) in order to answer the following:

- Which 10 Community Area Names in Chicago are associated with the most crime reports?

Chicago Crimes Data description: The dataset contains 204133 rows and 17 columns. The subjects are reported crimes in Chicago such that some crimes have been resolved and others are not. Some of the data columns are Case number, Date of occurrence, Block, IUC, Primary description, Secondary description, Location description, and Arrest. Original source is City of Chicago.

Chicago Public High Schools Progress Report Cards Data description: The dataset contains 93 rows and 42 columns. The subjects are high schools in the Chicago Public School system and their performance in various metrics of education. Some columns in this dataset include School ID and name, the type of school, Average student attendance, Rate of misconducts, 11th grade average ACT, Graduation rate, Freshmen on track %, Ward, and Location. Original source is City of Chicago.

**Answer:** An acceptable answer could be written as "The table below shows the 10 Community Area Names that are associated with the most crime reports." A more thorough answer would list those 10 Community Area Names out. This problem has more than one process that is logical and thus the solution may be different. One process is to do the filtering the parts then combining. Another process is to do the combining then the filtering. My solution does not address repeat values of Case #. If students address repeat values, then their answer will be different. If students were deducted 1 point for this problem, it will be returned.

```{r prob8}
crime <- read_csv("https://uofi.box.com/shared/static/xiipn7u18rcddau1q0elih3y7jcusket.csv", 
    col_types = cols(`DATE  OF OCCURRENCE` = col_datetime(format = "%m/%d/%Y %H:%M:%S %p")))
```


```{r}
crime2 <- crime %>% 
  distinct(`CASE#`, .keep_all=TRUE) %>%
  count(WARD)

chs2 <- chs %>% 
  rename(WARD=Ward)

x<-inner_join(crime2, chs2, by="WARD")

x %>%
  count(`Community Area Name`) %>%
  arrange(desc(n)) %>%
  slice_head(n=10)
```

Alternative solution.

```{r}
chs2 <- chs %>% 
  rename(WARD=Ward)

x<-inner_join(crime, chs2, by="WARD")

x %>%
  count(`Community Area Name`) %>%
  arrange(desc(n)) %>%
  slice_head(n=10)

```


**9** (Accessing and importing data, Arranging data, Data reduction, Data expansion, Vectorization, Regular expressions and string manipulation, Summarizing data, Combining data, Markdown) Using the Chicago Public High Schools Progress Report Cards Data (**imported in Problem 7**) and apply data management concepts to answer the following question(s) in Markdown syntax and complete sentence(s):

- Which unique combinations of Community Area Names and Wards are represented in the data more than two times?

Chicago Public High Schools Progress Report Cards Data description: The dataset contains 93 rows and 42 columns. The subjects are high schools in the Chicago Public School system and their performance in various metrics of education. Some columns in this dataset include School ID and name, the type of school, Average student attendance, Rate of misconducts, 11th grade average ACT, Graduation rate, Freshmen on track %, Ward, and Location. Original source is City of Chicago.

**Answer:** An acceptable answer could be written as "The table below shows unique combinations of Community Area Names and Wards are represented in the data more than two times." A more thorough answer would list those unique combinations out. My original solution was not correct due to a difference in interpretation and actual coding. If students were deducted 1 point for this problem, it will be returned. 

```{r prob9}
chs2 <- chs %>% 
  rename(WARD=Ward) %>% 
  arrange(WARD)

chs2 %>%
  mutate(newid = paste(`Community Area Name`,WARD)) %>%
  count(newid) %>%
  filter(n>2)
```

**#10** (Accessing and importing data, Arranging data, Data reduction, Data expansion, Vectorization, Regular expressions and string manipulation, Summarizing data, Combining data, Markdown) Import the Chicago 311 Service Requests for Abandoned Vehicles Data using its URL https://uofi.box.com/shared/static/7xlt7wshxuckkdiyqcs9i2e8mlaa2rg3.csv and apply data management concepts to answer the following question(s) in Markdown syntax and complete sentence(s):

- Among the 10 Wards associated with the most crime reports, which Community Area Name(s) is(are) associated with the most 311 service requests for abandoned vehicles?

Chicago 311 Service Requests for Abandoned Vehicles Data description: The dataset contains 261486 observations and 22 columns. The subjects are reports of abandoned vehicles around Chicago such that those reports are made to Chicago's 311 service. A vehicle can be classified as abandoned if it meets one or more of the following criteria: 1) On a public way in a state of disrepair as to be incapable of being driven in its present condition. 2) Has not been moved or used for more than seven consecutive days and is apparently deserted. 3) Has been left on the public way without state registration or a temporary state registration placard for two or more days. 4) Is a hazardous dilapidated vehicle left in full view of the general public, whether on public or private property. Requests that have been labeled as Duplicates are in the same geographic area and have been entered into 311 Customer Service Requests (CSR) system at around the same time as a previous request. Duplicate reports/requests are labeled as such in the Status field, as either "Open - Dup" or "Completed - Dup." Original source is City of Chicago.

**Answer:** Greater Grand Crossing is associated with the most 311 service requests for abandoned vehicles given the 10 Wards associated with the most crime reports. Similarly to Problem 8, if students were deducted 1 point for this problem, it will be returned.

```{r prob10}
x311 <- read_csv("https://uofi.box.com/shared/static/7xlt7wshxuckkdiyqcs9i2e8mlaa2rg3.csv", 
    col_types = cols(`Creation Date` = col_date(format = "%m/%d/%Y"), 
        `Completion Date` = col_date(format = "%m/%d/%Y")))

wards <- crime %>% 
  group_by(WARD) %>% 
  summarise(nn=n()) %>% 
  arrange(desc(nn)) %>% 
  slice_head(n=10) %>% 
  rename(Ward=WARD)

x3112 <- inner_join(wards,x311, by="Ward")

canmax <- x3112 %>% 
  count(`Community Area`) %>% 
  arrange(desc(n)) %>% 
  rename(`Community Area Number`=`Community Area`)

chs3 <- inner_join(chs,canmax, by="Community Area Number")

chs3 %>% 
  arrange(desc(n)) %>% 
  select(`Community Area Name`, n) %>% 
  slice_max(n)
```
